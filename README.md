# taosync
`tao-sync`是一个适用于`AList v3`的自动化同步工具，目前正处于早期版本，出于安全考虑暂不开源，待系统完善到一定程度后再开源。

**新项目急需Star，感谢各位！！**

本工具主要用于同步备份功能，可以定时扫描指定目录下文件差异，让目标目录与源目录相同（全同步模式）；或仅新增存在于源目录，却不存在于目标目录的文件（仅新增模式）。

桃桃是我女儿的名字，我女儿的名字叫桃桃。本工具意为：桃桃的自动同步工具

**警告！不要在外网暴露本系统，否则后果自负！如确实需要，请使用强密码！**

## 须知

本工具不使用`AList`源码而是使用[AList v3 API](https://alist.nn.ci/zh/guide/api/apifox.html)来实现相关功能。使用本工具前你必须了解并且会使用[AList](https://github.com/alist-org/alist)

本工具没有集成`AList`，你需要额外启动`AList`

## 使用方法

```sh
docker run -d -p 8023:8023 -v /opt/data:/app/data --name=taoSync dr34m/tao-sync:latest
```

把其中`/opt/data`替换为你实际的目录，然后访问`http://127.0.0.1:8023`

如果你没有修改，默认账号为`admin`，密码请到日志中查看输出，登录后请立即前往系统设置修改密码

> 部分系统的docker可能不显示这个日志，可以到挂载目录的`/log/sys_xxx.log`文件查看，通常在第一行

进入系统后先到`引擎管理`菜单创建引擎，然后前往`作业管理`创建同步作业

在绿联NAS中使用可以参考这里[如何在绿联NAS中使用TaoSync同步我的文件到各个网盘](https://blog.ctftools.com/2024/07/newpost-57/)

## 环境变量及其意义

修改环境变量需重启docker才能生效

| 变量名           | 描述                                                         | 默认值 |
| ---------------- | ------------------------------------------------------------ | ------ |
| TAO_EXPIRES      | 登录有效期，单位天                                           | 2      |
| TAO_LOG_LEVEL    | 日志等级：0-DEBUG，1-INFO，2-WARNING，3-ERROR，4-CRITICAL；数值越大，产生的日志越少，推荐1或2 | 1      |
| TAO_LOG_SAVE     | 系统日志保留天数，超过该天数会自动清理，单位天               | 7      |
| TAO_TASK_SAVE    | 任务记录保留天数，超过该天数会自动清理，单位天               | 60     |
| TAO_TASK_TIMEOUT | 任务执行超时时间，单位小时。一定要设置长一点，以免要备份的东西太多 | 72     |

## 页面截图

![引擎列表](README/引擎列表.png)

![引擎编辑](README/引擎编辑.png)

![新建作业](README/新建作业.png)

![作业列表](README/作业列表.png)

![任务列表](README/任务列表.png)

![任务详情](README/任务详情.png)

# 更新记录

### 0.1.3（2024-07-16）

* 修复安全问题

* 修改初始密码日志打印级别为最高，以免被过滤

### 0.1.2（2024-07-16）

* 数据攒齐批量入库，牺牲一点点的实时性但是可以显著提高性能，降低数据库锁定的可能性
* 作业详情（即任务列表）增加任务状态显示，可以展示`总文件数`、`成功`、`进行中`、`等待中`、`失败`、`其他`的数量
* 新建作业-同步间隔显示单位分钟
* 新建作业-部分选项增加提示
* 支持选择多个目标目录，方便一目录同步到多目录

### 0.1.1（2024-07-16）

* 不再支持配置端口（因为docker可以-p自定义端口）
* 不再支持账号密码配置，将自动生成，并打印到docker日志中（防止你懒，不改密码）
* 增加逻辑：5分钟内密码错误3次后将暂时禁止登录（直到最近5分钟内失败次数小于3次，重启docker可立即清除状态）
* 增大任务清理天数以及超时时间的默认值

### 0.1.0（2024-07-14）

* 支持引擎管理，可以自由增删改查`AList`
* 支持作业管理，可以新增/删除/启用/禁用作业
  * 作业管理支持仅新增与全同步模式
    * 仅新增：目标目录没有的，源目录有的，将从源目录复制到目标目录
    * 全同步：不仅有仅新增的功能；还将删除目标目录中比源目录多文件
* 支持作业详情（任务列表），可以查看历史任务
* 支持任务详情，可以查看每一项同步状态，支持根据状态与类型筛选
* 可以修改管理员密码
